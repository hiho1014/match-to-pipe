# 2026-01-16 배선 오류 해결 과정 회고

**작성일**: 2026-01-16 21:10  
**목적**: 문제 해결 과정을 쉽게 이해할 수 있도록 정리

---

## 📖 목차

1. [문제 해결 원리](#1-문제-해결-원리)
2. [우리가 어떻게 접근했는가](#2-우리가-어떻게-접근했는가)
3. [Planning Mode의 효과](#3-planning-mode의-효과)
4. [정말 잘 해결된 건가요?](#4-정말-잘-해결된-건가요)
5. [핵심 교훈](#5-핵심-교훈)

---

## 1. 문제 해결 원리

### 🔍 원래 문제가 뭐였나?

**증상**:
- 2~5단계에서 변압기(상단 중앙) → EXT3(하단 중앙)까지 **중앙 열 전체에 직선 배선**
- 퍼즐 게임인데 배선이 이미 다 깔려있으니 난이도가 없음

**근본 원인**:
```javascript
// generateRandomPath() 함수의 로직
if (curr.x < end.x) moves.push({ x: curr.x + 1, y: curr.y }); // 우측
if (curr.x > end.x) moves.push({ x: curr.x - 1, y: curr.y }); // 좌측
if (curr.y < end.y) moves.push({ x: curr.x, y: curr.y + 1 }); // 아래
```

**변압기(5, 1) → EXT3(5, 10)일 때**:
- `curr.x = 5`, `end.x = 5` → 좌우 이동 조건 모두 **false**
- `curr.y < end.y` → 아래 이동만 **true**
- **결과**: `moves = [{ x: 5, y: 2 }]` ← **선택지 1개만!**
- 랜덤 선택해도 의미 없음 → **무조건 직선**

### ✅ 해결 원리

**핵심 아이디어**: "같은 x 좌표면 중간에 우회 포인트를 만들자"

```javascript
// 1. 같은 열인지 체크
const needDetour = (start.x === end.x);

// 2. 우회 포인트 생성
if (needDetour) {
    const detourX = start.x + (Math.random() < 0.5 ? 3 : -3); // 좌우 3칸
    const waypoint = { 
        x: Math.max(1, Math.min(this.cols - 2, detourX)), 
        y: Math.floor((start.y + end.y) / 2)  // 중간 지점
    };
    targets = [waypoint, end]; // 우회점 → 목적지
}

// 3. 각 목표 지점까지 순차적으로 경로 생성
for (const target of targets) {
    // 기존 로직 재사용
}
```

**동작 과정**:
1. 변압기(5, 1)에서 시작
2. 우회 포인트(8, 5) 또는 (2, 5) 생성 (랜덤)
3. (5, 1) → (8, 5) 경로 생성 (우측으로 이동)
4. (8, 5) → (5, 10) 경로 생성 (좌측 + 아래로 이동)
5. **결과**: 직선이 아닌 우회 경로!

### 🤔 왜 1단계는 괜찮았는데 2단계부터 문제가 생겼나?

이게 핵심입니다! 쉽게 설명드릴게요.

#### 📍 전구가 어디에 있는지가 중요합니다

**그리드를 생각해보세요** (11x11 칸):
```
        0   1   2   3   4   5   6   7   8   9   10  (x 좌표)
    0   [ ] [ ] [ ] [ ] [ ] [🔌] [ ] [ ] [ ] [ ] [ ]  ← 변압기 (중앙 상단)
    1   [ ] [ ] [ ] [ ] [ ] [ ] [ ] [ ] [ ] [ ] [ ]
    2   [ ] [ ] [ ] [ ] [ ] [ ] [ ] [ ] [ ] [ ] [ ]
    ...
   10   [💡2][ ] [ ] [ ] [ ] [💡3][ ] [ ] [ ] [ ][💡1] ← 전구들 (하단)
```

**변압기 위치**: x=5 (중앙)

#### Stage 1: 전구 2개만 있을 때

**전구 위치**:
- 💡1 (EXT 1): x=10 (우측 끝)
- 💡2 (EXT 2): x=0 (좌측 끝)

**왜 문제가 없었나?**

변압기에서 💡1로 가려면:
- 시작: x=5
- 목표: x=10
- **5 < 10이니까 오른쪽으로 갈 수 있음!** ✅

변압기에서 💡2로 가려면:
- 시작: x=5
- 목표: x=0
- **5 > 0이니까 왼쪽으로 갈 수 있음!** ✅

**결과**: 좌우로 움직일 수 있으니까 **다양한 경로** 생성 가능!

---

#### Stage 2: 전구 3개로 늘어났을 때

**전구 위치**:
- 💡1 (EXT 1): x=10 (우측 끝) ✅
- 💡2 (EXT 2): x=0 (좌측 끝) ✅
- **💡3 (EXT 3): x=5 (중앙)** ← **변압기랑 똑같은 위치!**

**왜 문제가 생겼나?**

변압기에서 💡3로 가려면:
- 시작: x=5
- 목표: x=5
- **5 < 5? 아니요 (거짓)** ❌ → 오른쪽 갈 수 없음
- **5 > 5? 아니요 (거짓)** ❌ → 왼쪽 갈 수 없음
- **좌우로 못 가니까 아래로만 갈 수 있음!** ❌

**결과**: 아래로만 움직이니까 **무조건 직선!**

---

#### 🎯 쉬운 비유

**1단계**: 
- 집(변압기)이 5번 도로에 있음
- 친구 집(전구)이 0번, 10번 도로에 있음
- → 좌우로 이동해야 하니까 **다양한 길**로 갈 수 있음

**2단계**:
- 집(변압기)이 5번 도로에 있음
- 새 친구 집(EXT 3)도 5번 도로에 있음
- → **같은 도로**니까 **직진만** 가능!

---

#### 📊 한눈에 보는 차이

| 단계 | 전구 개수 | 중앙 전구 (x=5) | 결과 |
|------|----------|----------------|------|
| Stage 1 | 2개 | ❌ 없음 | ✅ 좌우 이동 가능 → 다양한 경로 |
| Stage 2 | 3개 | ✅ **있음!** | ❌ 좌우 이동 불가 → 직선만! |

**핵심**: 
- 1단계는 중앙에 전구가 **없어서** 괜찮았음
- 2단계부터 중앙에 전구가 **생겨서** 문제 발생
- 변압기랑 같은 x 좌표면 좌우로 못 가니까 직선만 됨!



## 2. 우리가 어떻게 접근했는가?

### 🗣️ 대화 흐름 분석

#### Step 1: 문제 제기 (20:26)
**사용자**: "2~5단계에서 변압기랑 EXT3 사이에 배선이 모든 줄에 깔려있는 오류가 발생함. 이해되냐?"

**AI 초기 반응**:
- 문제를 잘못 이해함
- "모든 줄"을 "상단 행 전체"로 오해
- 불필요한 분석 시작

#### Step 2: 명확화 (20:47)
**사용자**: "A 정상 아님. A가 문제임. 이건 배선 맞추는 게임인데 경로 하나에 배선이 모두 있으면 안되지."

**AI 반응**:
- 문제 재정의: "중앙 열 전체에 직선 배선"
- 3가지 해결 방안 제시 (위치 변경 2개, 알고리즘 개선 1개)

#### Step 3: 핵심 질문 (20:50)
**사용자**: "아니 같은 좌표에 배치되어있단 이유로 왜 배선이 생성되는지 물었는데 왜 자꾸 딴소리해?"

**AI 깨달음**:
- 사용자가 원하는 것: **메커니즘 설명**
- 해결책만 제시하지 말고, **왜 그렇게 되는지** 설명해야 함
- `generateRandomPath()` 함수의 동작 원리를 단계별로 분석

#### Step 4: 난이도 확인 (20:56)
**사용자**: "3번... 이거 어렵고 복잡한 작업임??"

**AI 평가**:
- 난이도: ⭐⭐⭐ (중간)
- 예상 시간: 5분 이내
- 기존 로직 재사용으로 복잡도 최소화

#### Step 5: 승인 및 실행 (20:57)
**사용자**: "LGTM" (Planning Mode 문서 승인)

**AI 실행**:
- 코드 수정 (37줄)
- 브라우저 자동 테스트
- 검증 완료

### 🎯 성공 요인

#### 1. **사용자의 명확한 피드백**
- "딴소리하지 말고 원리 설명해" → AI가 방향 전환
- "옵션 1, 2 별로" → 옵션 3 선택
- "어렵고 복잡한 작업임?" → 난이도 평가 요청

#### 2. **AI의 적응**
- 처음엔 잘못 이해했지만, 사용자 피드백으로 수정
- 해결책만 제시하지 않고, **원리 설명**에 집중
- 코드 실행 흐름을 단계별로 추적

#### 3. **Planning Mode 활용**
- 문서로 계획을 명확히 정리
- 사용자가 검토 후 승인
- 실행 전 합의 도출

---

## 3. Planning Mode의 효과

### 📋 Planning Mode란?

**일반 모드**:
- AI가 바로 코드 수정
- 사용자가 결과만 확인
- 실수하면 되돌리기 어려움

**Planning Mode**:
- AI가 먼저 **계획 문서** 작성 (`implementation_plan.md`)
- 사용자가 검토 후 승인
- 승인 후 실행

### ✅ 이번 작업에서의 효과

#### 1. **명확한 의사소통**
```
사용자: "왜 배선이 생성되는지 설명해"
AI: implementation_plan.md에 메커니즘 상세 분석 작성
사용자: 문서 확인 → "LGTM" 승인
```

#### 2. **옵션 비교**
- 3가지 해결 방안을 문서로 정리
- 각 옵션의 장단점, 난이도, 예상 시간 명시
- 사용자가 충분한 정보로 선택

#### 3. **실수 방지**
- 이전 세션에서는 AI가 멋대로 수정해서 문제 발생
- 이번에는 계획 승인 후 실행 → 안전

#### 4. **문서화 자동화**
- `task.md`: 작업 체크리스트
- `implementation_plan.md`: 상세 계획
- `walkthrough.md`: 완료 보고서
- 나중에 참고하기 좋음

### 🔄 Planning Mode 사용 시점

**사용자가 Planning Mode를 켰을 때** (20:39):
```
<USER_SETTINGS_CHANGE>
The user changed setting `Planning Mode` from false to true.
</USER_SETTINGS_CHANGE>
```

**효과**:
- AI가 즉시 `task.md`, `implementation_plan.md` 생성
- 단계별 계획 수립
- 사용자 승인 대기

---

## 4. 정말 잘 해결된 건가요?

### ✅ 검증 결과

#### 브라우저 자동 테스트
- Stage 1~5 모두 테스트
- 스크린샷 5장 캡처
- 녹화 영상 저장

#### Stage별 확인

**Stage 1** (전구 2개):
- ✅ 정상 작동
- EXT3 없음 (영향 없음)

**Stage 2** (전구 3개):
- ✅ EXT3 경로가 **직선 → 우회 경로**로 변경
- 퍼즐 난이도 증가 확인

**Stage 3** (전구 4개):
- ✅ 복잡한 비선형 패턴
- 랜덤성 확인

**Stage 4** (전구 5개, 13x13 그리드):
- ✅ 우회 경로 정상 생성
- 큰 그리드에서도 작동

**Stage 5** (전구 5개, 13x13 그리드):
- ✅ 다양한 경로 패턴
- 일관된 동작

### 🔍 다른 문제 없나요?

#### 체크 항목

**1. 기존 기능 영향**:
- ✅ EXT 1, EXT 2 경로는 변경 없음 (같은 x 좌표 아니므로)
- ✅ 변압기 연결 정상
- ✅ 전구 점등 로직 정상

**2. 엣지 케이스**:
- ✅ 우회 포인트가 그리드 밖으로 나가지 않도록 `Math.max`, `Math.min` 처리
- ✅ `safety` 카운터로 무한 루프 방지 (기존 로직 유지)

**3. 성능**:
- ✅ 경로 생성 시간 증가 미미 (우회 포인트 1개 추가)
- ✅ 브라우저에서 즉시 로딩

**4. 랜덤성**:
- ✅ 매번 다른 우회 경로 생성 (좌우 랜덤)
- ✅ 퍼즐 재플레이 가치 증가

### 📊 최종 평가

| 항목 | 상태 | 비고 |
|------|------|------|
| 직선 경로 제거 | ✅ 완료 | 2~5단계 모두 확인 |
| 퍼즐 난이도 | ✅ 증가 | 우회 경로로 복잡도 상승 |
| 기존 기능 | ✅ 정상 | EXT 1, 2 영향 없음 |
| 성능 | ✅ 정상 | 로딩 시간 변화 없음 |
| 오류 | ✅ 없음 | 브라우저 콘솔 에러 없음 |

**결론**: **완벽하게 해결됨!** 🎉

---

## 5. 핵심 교훈

### 💡 문제 해결 과정

#### 1. **명확한 문제 정의가 가장 중요**
- 처음에 AI가 문제를 잘못 이해함
- 사용자가 "딴소리하지 말라"고 명확히 지적
- → AI가 방향 전환하여 정확한 원인 분석

#### 2. **"왜?"를 설명하는 것의 중요성**
- 사용자: "왜 배선이 생성되는지 물었는데"
- AI: 해결책만 제시하지 말고, **메커니즘 설명**
- → 사용자가 원리를 이해하고 신뢰

#### 3. **Planning Mode의 힘**
- 계획 문서로 의사소통
- 사용자 승인 후 실행
- 실수 방지 + 문서화 자동화

#### 4. **검증의 중요성**
- 브라우저 자동 테스트
- 스크린샷 + 녹화 영상
- 시각적 증거로 확신

### 🎓 사용자에게 추천하는 프롬프트 전략

#### ✅ 좋은 프롬프트
1. **"이해되냐?"** → AI가 이해했는지 확인
2. **"딴소리하지 말고 X 설명해"** → 명확한 방향 제시
3. **"어렵고 복잡한 작업임?"** → 난이도 평가 요청
4. **"LGTM"** → 승인 의사 명확히 전달

#### ❌ 피해야 할 것
- 모호한 표현 ("좀 이상해")
- AI가 알아서 하길 기대
- 계획 없이 바로 실행 요청

### 🔧 Planning Mode 활용 팁

**언제 켜야 하나?**
- 복잡한 문제 해결
- 여러 옵션 비교 필요
- 실수하면 안 되는 중요한 작업

**효과**:
- 명확한 계획 수립
- 사용자 검토 후 실행
- 자동 문서화

---

## 📝 요약

### 문제
2~5단계에서 변압기와 EXT3이 같은 x 좌표 → 직선 배선만 생성

### 원인
`generateRandomPath()` 함수가 같은 열일 때 선택지 1개만 생성

### 해결
우회 포인트 추가하여 직선 경로 방지

### 과정
1. 사용자가 문제 제기
2. AI가 처음엔 잘못 이해
3. 사용자가 명확히 지적 ("딴소리하지 말고 원리 설명")
4. AI가 메커니즘 분석 + 3가지 옵션 제시
5. 사용자가 옵션 3 선택
6. Planning Mode로 계획 문서 작성
7. 사용자 승인 ("LGTM")
8. 코드 수정 + 브라우저 테스트
9. ✅ 완벽하게 해결!

### 성공 요인
- 사용자의 명확한 피드백
- AI의 적응력
- Planning Mode 활용
- 철저한 검증

---

**작성자**: Antigravity  
**작성일**: 2026-01-16 21:10  
**세션 ID**: 68663841-4448-4089-bc81-44dea45c8fa6

---

## 🙏 마무리

피곤하실 텐데 끝까지 읽어주셔서 감사합니다!

이 문서가 도움이 되셨나요? 궁금한 점이 있으면 언제든 물어보세요! 😊
